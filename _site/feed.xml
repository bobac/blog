<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2025-11-26T16:05:59+01:00</updated><id>/feed.xml</id><entry><title type="html">Jak Azure AD Connect pracuje s účty ADSyncMSA a MSOL – stručné a praktické vysvětlení</title><link href="/2025/11/26/jak-azure-ad-connect-pracuje-s-ucty-v-AD.html" rel="alternate" type="text/html" title="Jak Azure AD Connect pracuje s účty ADSyncMSA a MSOL – stručné a praktické vysvětlení" /><published>2025-11-26T00:00:00+01:00</published><updated>2025-11-26T00:00:00+01:00</updated><id>/2025/11/26/jak-azure-ad-connect-pracuje-s-ucty-v-AD</id><content type="html" xml:base="/2025/11/26/jak-azure-ad-connect-pracuje-s-ucty-v-AD.html">&lt;p&gt;V praxi není nic neobvyklého, když po instalaci Azure AD Connect najdete v AD pár podivných účtů, které na první pohled nedávají smysl. Tato konverzace objasnila, co je co, a proč někdy může nastat problém při přidávání těchto účtů do skupin podle interních politik.&lt;/p&gt;

&lt;h2 id=&quot;co-vlastně-azure-ad-connect-vytváří&quot;&gt;Co vlastně Azure AD Connect vytváří&lt;/h2&gt;
&lt;h3 id=&quot;1-adsyncmsaxxxx--definice-gmsa&quot;&gt;1. &lt;strong&gt;ADSyncMSAxxxx&lt;/strong&gt; – definice gMSA&lt;/h3&gt;
&lt;p&gt;Tohle je objekt typu &lt;em&gt;Group Managed Service Account&lt;/em&gt;. Není to běžný uživatelský účet a nemůže se přihlásit. Je to jen „hlavička“ účtu, kterou Active Directory používá k řízení hesel a atributů.&lt;/p&gt;

&lt;h3 id=&quot;2-adsyncmsaxxxx--skutečný-bezpečnostní-principal&quot;&gt;2. &lt;strong&gt;ADSyncMSAxxxx$&lt;/strong&gt; – skutečný bezpečnostní principal&lt;/h3&gt;
&lt;p&gt;Služba „Microsoft Azure AD Sync“ běží právě pod tímto účtem.&lt;br /&gt;
Je to reálný logon účet a má &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; stejně jako počítačové účty.&lt;br /&gt;
V konzoli MMC ho ale často vůbec neuvidíte, což mate správce.&lt;/p&gt;

&lt;h3 id=&quot;3-msol_xxxxxxx--starý-service-account&quot;&gt;3. &lt;strong&gt;MSOL_xxxxxxx&lt;/strong&gt; – starý service account&lt;/h3&gt;
&lt;p&gt;Tohle je účet ze starší verze AAD Connect. Moderní instalace už tento účet nepoužívají, ale účet v AD zůstává jako pozůstatek. Nemá vztah k současnému gMSA účtu.&lt;/p&gt;

&lt;h2 id=&quot;proč-nejde-účet-najít-v-ad&quot;&gt;Proč nejde účet najít v AD&lt;/h2&gt;
&lt;p&gt;MMC (dsa.msc) neumí zobrazit gMSA tak, jak by člověk čekal.&lt;br /&gt;
Vidíte prázdný kontejner, nevidíte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; účet, ale Azure AD Sync služba pod ním běží.&lt;/p&gt;

&lt;p&gt;Řešením je:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;použít PowerShell,&lt;/li&gt;
  &lt;li&gt;nebo použít ADAC (který gMSA zobrazuje správně).&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;jak-přidat-adsync-gmsa-do-skupiny&quot;&gt;Jak přidat ADSync gMSA do skupiny&lt;/h2&gt;
&lt;p&gt;Interní politika vyžaduje, aby všechny účty služeb byly členem určité skupiny — například &lt;em&gt;grpservice&lt;/em&gt;.&lt;br /&gt;
Proto je potřeba přidat &lt;strong&gt;ADSyncMSAxxxx$&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;PowerShell řeší situaci okamžitě:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Add-ADGroupMember&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grpservice&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Members&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ADSyncMSAxxxx$&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pokud by vyhledání selhalo, použije se DN definice gMSA, AD si to sám namapuje.&lt;/p&gt;

&lt;h2 id=&quot;závěr&quot;&gt;Závěr&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Azure AD Connect používá gMSA, ne starý MSOL účet.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; varianta je ta, kterou používá služba.&lt;/li&gt;
  &lt;li&gt;Pro přidání do skupiny je nutné pracovat právě s ní.&lt;/li&gt;
  &lt;li&gt;Starý účet MSOL můžeš s klidem smazat, pokud už není v provozu.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Celá situace vzniká jen díky tomu, že MMC nepodává úplný obraz.&lt;br /&gt;
Jakmile člověk ví, co který objekt je, dává to celé perfektní smysl.&lt;/p&gt;</content><author><name>bobac</name></author><category term="azure" /><category term="ad" /><category term="chatgpt" /><summary type="html">V praxi není nic neobvyklého, když po instalaci Azure AD Connect najdete v AD pár podivných účtů, které na první pohled nedávají smysl. Tato konverzace objasnila, co je co, a proč někdy může nastat problém při přidávání těchto účtů do skupin podle interních politik.</summary></entry><entry><title type="html">M365 - Jak na detaily u sdíleného resource mailboxu</title><link href="/2022/01/14/M365-jak-na-detaily-u-sdileneho-mailboxu.html" rel="alternate" type="text/html" title="M365 - Jak na detaily u sdíleného resource mailboxu" /><published>2022-01-14T00:00:00+01:00</published><updated>2022-01-14T00:00:00+01:00</updated><id>/2022/01/14/M365-jak-na-detaily-u-sdileneho-mailboxu</id><content type="html" xml:base="/2022/01/14/M365-jak-na-detaily-u-sdileneho-mailboxu.html">&lt;p&gt;Pokud na M365 vyrobíte sdílený resource mailbox (třeba na rezervace zasedačky, nebo auta), je nepříjemné, že ve výchozím stavu není vidět, kdo má daný prostředek rezervovaný, pokud se do kalendáře podíváte z Outlooku - je tam jen, že je Busy.&lt;/p&gt;

&lt;p&gt;Zajistit, aby &lt;strong&gt;Exchange Online&lt;/strong&gt; do vytvořené události laskavě připsala, kdo je za ní zodpovědný, je možné pomocí následujících příkazů v &lt;em&gt;PowerShellu&lt;/em&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Import-Module ExchangeOnlineManagement
Connect-ExchangeOnline -UserPrincipalName admin@firma.onmicrosoft.com
Set-MailboxFolderPermission -Identity sdilenymailbox:\Calendar -User default -AccessRights LimitedDetail
Set-CalendarProcessing -Identity sdilenymailbox -AddOrganizerToSubject $true -DeleteComments $false -DeleteSubject $false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;poznámka&quot;&gt;Poznámka&lt;/h3&gt;
&lt;p&gt;Je nepříjemné, že jsem nepřišel na to, jak udělat to samé, ale být přihlášen jako já, a vyrobit to pro jiného tenanta. Jinými slovy, musím být přihlášen jako admin organizace, pro kterou to nastavuju, ne jako admin organizace, která tuhle organizaci spravuje. Grrrr.!!!&lt;/p&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Jako tradičně jsem to vykradl někde jinde - jmenovitě &lt;a href=&quot;https://lazyadmin.nl/office-365/show-details-room-mailbox-meetings-in-its-calendar-in-office-365/&quot;&gt;tady&lt;/a&gt;.&lt;/p&gt;</content><author><name>bobac</name></author><category term="m365" /><summary type="html">Pokud na M365 vyrobíte sdílený resource mailbox (třeba na rezervace zasedačky, nebo auta), je nepříjemné, že ve výchozím stavu není vidět, kdo má daný prostředek rezervovaný, pokud se do kalendáře podíváte z Outlooku - je tam jen, že je Busy.</summary></entry><entry><title type="html">Docker Compose - znovupoužití image, kterou buildovala jiná service</title><link href="/2021/12/01/docker-znovupouziti-image.html" rel="alternate" type="text/html" title="Docker Compose - znovupoužití image, kterou buildovala jiná service" /><published>2021-12-01T00:00:00+01:00</published><updated>2021-12-01T00:00:00+01:00</updated><id>/2021/12/01/docker-znovupouziti-image</id><content type="html" xml:base="/2021/12/01/docker-znovupouziti-image.html">&lt;p&gt;Potřeboval jsem &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;, který buildil image z &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; místo toho, aby ji hotovou odněkud stahoval, nebo abych ji nemusel buildovat předtím já ručně pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker build...&lt;/code&gt;. To je docela šikovná věc, zejména, pokud ta image je to, co zrovna vyvíjíte. &lt;strong&gt;Docker Compose&lt;/strong&gt; na to má hezkou direktivu &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;build&lt;/code&gt; místo tradiční &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;image&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Problém je v tom, že jsem potřeboval 2 různé service, které ale budou vždy zbuilděné (krásný český slovo) ze stejné image. Nejdřív jsem to nahulváta dělal tak, že jsem prostě v každé service znova buildil, ale pak mě okolnosti donutily chvíli buildit s direktivou &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--no-cache&lt;/code&gt; a celé se to začelo nějak vléct. Nezbývalo než začít gůglit, jak to udělat, aby build proběhl jen jednou a druhá service jej jen použila.&lt;/p&gt;

&lt;h2 id=&quot;jak-na-to&quot;&gt;Jak na to&lt;/h2&gt;
&lt;p&gt;Je to samozřejmě easy. Stačí, aby první service udělala build a zároveň hotovou image nějak pojmenovala, a pak už jen stačí, aby ta druhá použila tuhle image a měla nastavenou dependecy na té první. Asi takhle &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: &apos;3&apos;

services:

  master:
      build: .
      image: mojeimage

  slave:
      image: mojeimage
      depends_on: master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;použití&quot;&gt;Použití&lt;/h2&gt;
&lt;p&gt;Pak už stačí jen image zbuildit pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose build&lt;/code&gt;. Docker Compose buildne &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;master&lt;/code&gt; image a pojmenuje ji &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mojeimage&lt;/code&gt;.Následný &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose up&lt;/code&gt; už pustí obě services z jediné image.&lt;/p&gt;

&lt;h3 id=&quot;poznámka&quot;&gt;Poznámka&lt;/h3&gt;
&lt;p&gt;Preferuji vytvoření &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; a následné buildění (pokud to jde) pomocí &lt;strong&gt;Docker Compose&lt;/strong&gt; zejména proto, že v podstatě předpis (který tak jako tak potřebuju) mám v &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; a nemusím přemýšlet (to bolí vždy) nad tím, jak pojmenovat image apod. tak, aby to fungovalo. Samozřejmě, že by fungovalo ručně zbuildit pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker build -t mojeimage .&lt;/code&gt;, ale tam bych musel jméno image nejdřív stejně vyčíst ze svého &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;. Takhle je to jednodušší :-)&lt;/p&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Celé jsem to ukradl na &lt;a href=&quot;https://stackoverflow.com/questions/50019948/reuse-image-built-by-one-service-in-another-service/50025029#:~:text=28-,Docker%20Compose,-builds%20your%20image&quot;&gt;Stack Overflow&lt;/a&gt;.&lt;/p&gt;</content><author><name>bobac</name></author><category term="docker" /><summary type="html">Potřeboval jsem docker-compose.yml, který buildil image z Dockerfile místo toho, aby ji hotovou odněkud stahoval, nebo abych ji nemusel buildovat předtím já ručně pomocí docker build.... To je docela šikovná věc, zejména, pokud ta image je to, co zrovna vyvíjíte. Docker Compose na to má hezkou direktivu build místo tradiční image.</summary></entry><entry><title type="html">Příprava LVM pro instalaci Linuxu</title><link href="/2021/11/23/lvm.html" rel="alternate" type="text/html" title="Příprava LVM pro instalaci Linuxu" /><published>2021-11-23T00:00:00+01:00</published><updated>2021-11-23T00:00:00+01:00</updated><id>/2021/11/23/lvm</id><content type="html" xml:base="/2021/11/23/lvm.html">&lt;p&gt;Experimentuji z Arch Linuxem. Hlavní důvod je, že se zdá, že Arch je cesta, jak pochopit, relativně do detailů, jak některé věci, které před námi “velké” distribuce jako Debian, Ubuntu, či třeba Fedora tají tím, že je tak nějak udělají za nás. V následujcím postu se pokusím popsat, co je třeba udělat k rozběhnutí &lt;strong&gt;Linuxu na LVM s GPT diskem a EFI&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;partitions&quot;&gt;Partitions&lt;/h2&gt;

&lt;p&gt;Vyrobil jsem si GPT disk se 3 partition:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/dev/sda1 - EFI System - 512MB
/dev/sda2 - Linux Swap - 2*RAM
/dev/sda3 - Linux LVM - 220GB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;swap&quot;&gt;Swap&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;vytvoření swapu: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkswap /dev/sda2&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;zapnutí swapu: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;swapon /dev/sda2&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;ověření, že swap swappuje - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;formátování-efi-partition&quot;&gt;Formátování EFI partition&lt;/h2&gt;

&lt;p&gt;EFI naformátujeme jako &lt;em&gt;FAT32&lt;/em&gt; pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkfs.fat -F 32 /dev/sda1&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;lvm&quot;&gt;LVM&lt;/h2&gt;

&lt;h3 id=&quot;zjištění-jaké-lvm-capable-partition-máme-k-dispozici&quot;&gt;Zjištění, jaké LVM capable partition máme k dispozici&lt;/h3&gt;
&lt;p&gt;Bylo by hezké, kdyby tam byly i ty naše nově vytvořené:-)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lvmdiskscan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vytvoření-lvm-physical-volume&quot;&gt;Vytvoření LVM Physical Volume&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pvcreate DEVICE&lt;/code&gt; kde &lt;em&gt;DEVICE&lt;/em&gt; může být disk nebo partition. &lt;strong&gt;POZOR!&lt;/strong&gt; je to destruktivní akce:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# pvcreate /dev/sda3
  Physical volume &quot;/dev/sda3&quot; successfully created.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ověření: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pvdisplay&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &quot;/dev/sda3&quot; is a new physical volume of &quot;220.00 GiB&quot;
  --- NEW Physical volume ---
  PV Name               /dev/sda3
  VG Name
  PV Size               220.00 GiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               Dhjl3L-fHD3-Yic2-R3s9-e1Op-mPka-FCGgwF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sumář lze také získat pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pvscan&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  PV /dev/sda3                      lvm2 [220.00 GiB]
  Total: 1 [220.00 GiB] / in use: 0 [0   ] / in no VG: 1 [220.00 GiB]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vytvoření-volume-group&quot;&gt;Vytvoření volume group&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vgcreate lvm_root /dev/partition&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;V našem případě:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@archiso ~ # vgcreate vg_arch /dev/sda3
  Volume group &quot;vg_arch&quot; successfully created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ověření, že VG existují pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vgdisplay&lt;/code&gt;. Výstup vypadá takhle:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  --- Volume group ---
  VG Name               vg_arch
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               &amp;lt;220.00 GiB
  PE Size               4.00 MiB
  Total PE              56319
  Alloc PE / Size       0 / 0
  Free  PE / Size       56319 / &amp;lt;220.00 GiB
  VG UUID               Mu8Gq9-3v9O-TL3F-RKZC-Z31D-TzOY-GUG9LZ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;rozšiřování-volume-group&quot;&gt;Rozšiřování volume group&lt;/h3&gt;
&lt;p&gt;Již existující volume group je možné rozšířit o další zařízení, např:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vgextend vg_arch /dev/sdb1&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;vytvoření-logical-volumes&quot;&gt;Vytvoření logical volumes&lt;/h3&gt;
&lt;p&gt;Vytvoříme 30GB &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvm_root&lt;/code&gt; (/) a 80% zbytku použijeme na &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvm_home&lt;/code&gt; (/home):&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lvcreate -L 30G vg_arch -n lvm_root
  Logical volume &quot;lvm_root&quot; created.
# lvcreate -l 80%FREE vg_arch -n lvm_home
  Logical volume &quot;lvm_home&quot; created.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ověříme pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvdisplay&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  --- Logical volume ---
  LV Path                /dev/vg_arch/lvm_root
  LV Name                lvm_root
  VG Name                vg_arch
  LV UUID                5qKjyS-4Rik-t61M-yXpV-yLke-yBoU-fkylRd
  LV Write Access        read/write
  LV Creation host, time archiso, 2021-11-23 13:01:37 +0000
  LV Status              available
  # open                 0
  LV Size                30.00 GiB
  Current LE             7680
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           254:1

  --- Logical volume ---
  LV Path                /dev/vg_arch/lvm_home
  LV Name                lvm_home
  VG Name                vg_arch
  LV UUID                RKPFXX-59Eh-8PhI-PsAb-zuC0-HNXQ-xP4zhn
  LV Write Access        read/write
  LV Creation host, time archiso, 2021-11-23 13:04:09 +0000
  LV Status              available
  # open                 0
  LV Size                &amp;lt;152.00 GiB
  Current LE             38911
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           254:2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;naformátování-a-mountování-lv&quot;&gt;Naformátování a mountování LV&lt;/h3&gt;
&lt;p&gt;Logical volumes jsou k dispozici v &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/vg_arch&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls /dev/vg_arch
lvm_home  lvm_root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pokud nejsou vidět (u mě ano), mělo by pomoci nahrání kernel modulu a jejich zpřístupnění:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;modprobe dm_mod
vgscan
vgchange -ay
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Naformátování a mountování&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkfs.&amp;lt;fstype&amp;gt; /dev/&amp;lt;volume_group&amp;gt;/&amp;lt;logical_volume&amp;gt;
mount /dev/&amp;lt;volue_group&amp;gt;/&amp;lt;logical_volume&amp;gt; /&amp;lt;mountpoint&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Takže v našem případě:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkfs.ext4 /dev/vg_arch/lvm_root
mount /dev/vg_arch/lvm_root /mnt

mkdir /mnt/home
mkfs.ext4 /dev/vg_arch/lvm_home
mount /dev/vg_arch/lvm_home /mnt/home
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;příště&quot;&gt;Příště&lt;/h2&gt;
&lt;p&gt;Co s EFI bootem a tak… Snad. Asi. možná.&lt;/p&gt;</content><author><name>bobac</name></author><category term="linux" /><summary type="html">Experimentuji z Arch Linuxem. Hlavní důvod je, že se zdá, že Arch je cesta, jak pochopit, relativně do detailů, jak některé věci, které před námi “velké” distribuce jako Debian, Ubuntu, či třeba Fedora tají tím, že je tak nějak udělají za nás. V následujcím postu se pokusím popsat, co je třeba udělat k rozběhnutí Linuxu na LVM s GPT diskem a EFI.</summary></entry><entry><title type="html">Změna SATA RAID mode na AHCI a nebootující Windows 10</title><link href="/2021/11/22/zmena-raid-na-ahci-windows-10.html" rel="alternate" type="text/html" title="Změna SATA RAID mode na AHCI a nebootující Windows 10" /><published>2021-11-22T00:00:00+01:00</published><updated>2021-11-22T00:00:00+01:00</updated><id>/2021/11/22/zmena-raid-na-ahci-windows-10</id><content type="html" xml:base="/2021/11/22/zmena-raid-na-ahci-windows-10.html">&lt;p&gt;Potřeboval jsem u svého stárnoucího &lt;strong&gt;Dell OptiPLex 3050&lt;/strong&gt; změnit v BIOSu režim SATA disku z RAID na AHCI. Potřeboval jsem to proto, že primární disk je NVME, na něm jsou &lt;strong&gt;Windows 10&lt;/strong&gt;, a na druhém (SATA) mám &lt;strong&gt;Ubuntu 20.04&lt;/strong&gt;. Potřebuji z Linuxu vidět na Windowsí disk a gůglením jsem zjistil, že důvod, proč žádné &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/nvme*&lt;/code&gt; nevidím není v tom, že by můj kernel 5.4.xx NVME nepodporoval, NVME je podporováno už od kernelu 3.3, ale v tom, že kernel nevidí NVME disk, když je v BIOSu nastavený SATA RAID mode.&lt;/p&gt;

&lt;p&gt;Bohužel po přepnutí do AHCI režimu Windows odmítaly botovat, vždy skončily v režimu opravy. Málem jsem začal Windows opravovat z instalačního média, ale představa ukládání 5GB image na pomalou flešku mě donutila ještě chvíli gůglit a zde je, co jsem vygůglil.&lt;/p&gt;

&lt;p&gt;Problém je v podstatě jen v tom, že Windows nemají zavedený AHCI ovladač disku, stačí je nabootovat do Safe mode, ovladač se sám načte a po dalším rebootu do normálního režimu už je vše OK.&lt;/p&gt;

&lt;h2 id=&quot;postup&quot;&gt;Postup&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;V běžících Windows se SATA mode RAID pustit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmd&lt;/code&gt; jako Administrator.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bcdedit /set {current} safeboot minimal&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Reboot do BIOSu a změna na SATA mode na AHCI&lt;/li&gt;
  &lt;li&gt;Nabootovat do Windows (díky bodu 2 nastartují vždy v safe mode).&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bcdedit /deletevalue {current} safeboot&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Reboot - už to najede normálně v AHCI modu a Windows se spustí&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;poznámky&quot;&gt;Poznámky&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;V níže uvedeném postu se píše, že je třeba znát heslo uživatele (ne PIN, pokud používáte AzureAD). Uvedené používám, přesto mým Windows 10 21H2 pin stačil, žádné heslo jsem nepořeboval. Ale pozor na to, je dobré jej znát, co kdyby.&lt;/li&gt;
  &lt;li&gt;Stejně tak se tam píše, že budete potřebovat &lt;em&gt;Recovery key&lt;/em&gt;, pokud používáte &lt;strong&gt;Bitlocker&lt;/strong&gt;. Používám, měl jsem jej po ruce, nebyl třeba.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;

&lt;p&gt;Čerpal jsem ve fóru na &lt;a href=&quot;https://superuser.com/questions/1280141/switch-raid-to-ahci-without-reinstalling-windows-10#:~:text=56-,There,-is%20actually%20another&quot;&gt;Superuser&lt;/a&gt;. Nepoužil jsem preferred řešení, ale to níže uvedené (link ukazuje přímo do textu, pokud používáte poslední Chrome, já mám &lt;em&gt;96.0.4664.55&lt;/em&gt;).&lt;/p&gt;</content><author><name>bobac</name></author><category term="windows" /><summary type="html">Potřeboval jsem u svého stárnoucího Dell OptiPLex 3050 změnit v BIOSu režim SATA disku z RAID na AHCI. Potřeboval jsem to proto, že primární disk je NVME, na něm jsou Windows 10, a na druhém (SATA) mám Ubuntu 20.04. Potřebuji z Linuxu vidět na Windowsí disk a gůglením jsem zjistil, že důvod, proč žádné /dev/nvme* nevidím není v tom, že by můj kernel 5.4.xx NVME nepodporoval, NVME je podporováno už od kernelu 3.3, ale v tom, že kernel nevidí NVME disk, když je v BIOSu nastavený SATA RAID mode.</summary></entry><entry><title type="html">Clonezilla - divná chyba MBR a GPT mismatch</title><link href="/2021/11/19/Clonezilla-MBR-GPT-Mismatch-error.html" rel="alternate" type="text/html" title="Clonezilla - divná chyba MBR a GPT mismatch" /><published>2021-11-19T00:00:00+01:00</published><updated>2021-11-19T00:00:00+01:00</updated><id>/2021/11/19/Clonezilla-MBR-GPT-Mismatch-error</id><content type="html" xml:base="/2021/11/19/Clonezilla-MBR-GPT-Mismatch-error.html">&lt;p&gt;Experimentoval jsem s &lt;a href=&quot;https://clonezilla.org/&quot;&gt;Clonezillou&lt;/a&gt;. Nainstaloval jsem čisté &lt;strong&gt;Windows 10 Pro&lt;/strong&gt; na disk, kde už předtím nějaká Win10 byla. Nicméně jsem v setupu na začátku vykilloval všechny partition a do prázdného místa nainstaloval Windows znovu. Po tradičním zapatchování jsem chtěl Clonezillou udělat image celého disku. Po odbouchání next - next - next víceméně s defaultním nastavením na mě vypadla divná chyba, něco jako &lt;em&gt;“this disk contains mismatched gpt and mbr”&lt;/em&gt; a imagování crashlo ještě dřív, než začalo.&lt;/p&gt;

&lt;p&gt;No, a protože jsem začal gůglit a na první dobrou jsem si pěkně MBR partition zlikvidoval tak, že wokna ani nezačala bootovat, podruhé jsem gůglil pozorněji a tady je postup, co v takovém případě udělat - tohle fungovalo. Pro mě dobrá zpráva je, že jsem na disku neměl žádná data, takže kromě ztráty času se nekonal žádný stress :-)&lt;/p&gt;

&lt;h2 id=&quot;postup&quot;&gt;Postup&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;přepnout se do command line (já jsem použil chvat Alt - šipka vlevo, ale Clonezilla na to má i meníčko)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo gdisk /dev/sda&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Dostanete něco jako:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Partition table scan:
MBR: MBR only
BSD: not present
APM: not present
GPT: present

Found valid MBR and GPT. Which do you want to use?
1 – MBR
2 – GPT
3 – Create blank GPT

Your answer:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Zvolíte 1 - MBR&lt;/li&gt;
  &lt;li&gt;následuje:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Command (? for help): x

Expert command (? for help): z
About to wipe out GPT on /dev/sda. Proceed? (Y/N): y
GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
Blank out MBR? (Y/N): n
MBR is unchanged. You may need to delete an EFI GPT (0xEE) partition
with fdisk or another tool.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;done&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Našel jsem to původně &lt;a href=&quot;https://casits.artsandsciences.fsu.edu/tips/cloning-systems/mismatched-GPT-MBR-error&quot;&gt;tady&lt;/a&gt;.&lt;/p&gt;</content><author><name>bobac</name></author><category term="windows" /><summary type="html">Experimentoval jsem s Clonezillou. Nainstaloval jsem čisté Windows 10 Pro na disk, kde už předtím nějaká Win10 byla. Nicméně jsem v setupu na začátku vykilloval všechny partition a do prázdného místa nainstaloval Windows znovu. Po tradičním zapatchování jsem chtěl Clonezillou udělat image celého disku. Po odbouchání next - next - next víceméně s defaultním nastavením na mě vypadla divná chyba, něco jako “this disk contains mismatched gpt and mbr” a imagování crashlo ještě dřív, než začalo.</summary></entry><entry><title type="html">Jak nastavit Windows, aby braly hodiny v počítači dle UTC</title><link href="/2021/11/19/Jak-nastavit-Windows-hodiny-na-UTC.html" rel="alternate" type="text/html" title="Jak nastavit Windows, aby braly hodiny v počítači dle UTC" /><published>2021-11-19T00:00:00+01:00</published><updated>2021-11-19T00:00:00+01:00</updated><id>/2021/11/19/Jak-nastavit-Windows-hodiny-na-UTC</id><content type="html" xml:base="/2021/11/19/Jak-nastavit-Windows-hodiny-na-UTC.html">&lt;p&gt;Občas je třeba, aby RTC hodiny v počítači byly nastaveny na &lt;em&gt;UTC&lt;/em&gt;, ale aby Windows ukazovaly čas dle naší časové zóny, tedy &lt;em&gt;local time&lt;/em&gt;. Hodí se to třeba v případě, že provozujete dual boot Windows a Linux. Obecně je totiž zvykem, že Windows očekávají, že jsou hodiny v počítači nastaveny na místní čas, kdežto Linux očekává, že hodiny v počítači jsou nastaveny na UTC.&lt;/p&gt;

&lt;p&gt;To způsobuje následující problémy:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;liší se časy souborů vytvořených jednotlivými systémy o rozdíl mezi UTC a místním časem (u nás o 1 až 2 hodiny, podle toho, jestli máme zrovna letní nebo zimní čas)&lt;/li&gt;
  &lt;li&gt;systémy se neustále přetahují o to, na kolik budou hodiny nastaveny, protože synchronizace času z internetu nastavuje taky RTC hodiny v počítači&lt;/li&gt;
  &lt;li&gt;následkem čeho není čas nikdy dobře :-)&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;co-s-tím&quot;&gt;Co s tím&lt;/h2&gt;
&lt;p&gt;Stačí Windows říct, že mají taky počíat s tím, že čas v RTC hodinách v počítači (ten, co si nastavujete v setupu) je UTC. Stačí na to jednoduchá úprava v registrech:&lt;/p&gt;

&lt;p&gt;V klíči &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TimeZoneInformation&lt;/code&gt; vytvořte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;QWORD&lt;/code&gt; se jménam &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RealTimeIsUniversal&lt;/code&gt; a nastavte jeho hodnotu na &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; a rebootněte systém. To je vše.&lt;/p&gt;

&lt;p&gt;Pokud náhodou používáte 32bitová Windows (existuje ještě někdo takový?), místo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;QWORD&lt;/code&gt; použijte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DWORD&lt;/code&gt;.&lt;/p&gt;</content><author><name>bobac</name></author><category term="windows" /><summary type="html">Občas je třeba, aby RTC hodiny v počítači byly nastaveny na UTC, ale aby Windows ukazovaly čas dle naší časové zóny, tedy local time. Hodí se to třeba v případě, že provozujete dual boot Windows a Linux. Obecně je totiž zvykem, že Windows očekávají, že jsou hodiny v počítači nastaveny na místní čas, kdežto Linux očekává, že hodiny v počítači jsou nastaveny na UTC.</summary></entry><entry><title type="html">Navidrome - self hosted music streaming</title><link href="/2021/11/17/Navidrome-self-hosted-music-streaming.html" rel="alternate" type="text/html" title="Navidrome - self hosted music streaming" /><published>2021-11-17T00:00:00+01:00</published><updated>2021-11-17T00:00:00+01:00</updated><id>/2021/11/17/Navidrome-self-hosted-music-streaming</id><content type="html" xml:base="/2021/11/17/Navidrome-self-hosted-music-streaming.html">&lt;p&gt;V minulém &lt;a href=&quot;/2021/11/17/Tagy-na-mp3-z-cli.html&quot;&gt;blogu&lt;/a&gt; jsem psal o &lt;strong&gt;mid3v2&lt;/strong&gt; k editování MP3 Tagů z CLI. Potřeboval jsem si rozběhnout vlastní streamování MP3, které bude mimo iTunes. Jde o to, že mám pár audioknih, které jsem koupil u &lt;a href=&quot;https://kechlibar.net/obchod/&quot;&gt;Mariana Kechlibara&lt;/a&gt;, a které jsem potřeboval oddělit od iTunes. Důvod je poměrně jednoduchý - chci, abych měl rozposlouchanou knihu někde jinde než muziku, z toho prostého důvodu, že iTunes nemá žádné záložky, takže jakmile pustím nějakou hudbu, prd vím, kde jsem přestal poslouchat knížku :-)&lt;/p&gt;

&lt;h2 id=&quot;požadavky&quot;&gt;Požadavky&lt;/h2&gt;
&lt;p&gt;Celkem jednoduché:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Musí to běžet na některém z mých serverů, takže &lt;em&gt;Linux&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;Potřebuji k tomu nějakého klienta pro iOS, kde to budu reálně poslouchat (i když je samozřejmě hezké, že si můžu pustit cokoliv odkudkoliv jen z browseru), ale není to můj hlavní use-case.&lt;/li&gt;
  &lt;li&gt;Bylo by hezký, kdyby to mělo hotový &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;, aby zprovoznění nesežralo příliš lidského sádla.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Moje řešení splňuje vše.&lt;/p&gt;

&lt;h2 id=&quot;instalace&quot;&gt;Instalace&lt;/h2&gt;
&lt;p&gt;Do nějakého adresáře uložte následující &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: &quot;3.3&quot;
services:
  navidrome:
    image: deluan/navidrome:latest
    restart: unless-stopped
    ports:
      - &quot;4533:4533&quot;
    environment:
      ND_SCANINTERVAL: 30m
      ND_LOGLEVEL: info
      ND_BASEURL: &quot;&quot;
    volumes:
      - &quot;./data:/data&quot;
      - &quot;/path/to/your/music/here:/music:ro&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/path/to/your/music/here&lt;/code&gt; je v mém případě na zfs svazku, který se jmenuje &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tank/audiobooks&lt;/code&gt;, což s sebou přineslo nepříjemný efekt, že kontejner nešlo spustit s obskurní chybovou hláškou, že nemůže vytvořit volume, které je read-only, či něco podobného. Strejda Gůgl mi řekl, že je to proto, že mám docker nainstalovaný (Ubuntu 20.04) pomocí &lt;strong&gt;snap&lt;/strong&gt; balíčků, až že se to pak u zfs stává. Řešením bylo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo snap remove docker&lt;/code&gt; a instalace pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt&lt;/code&gt;, návodů je plný internet. Nepříjemností je, že budete muset re-creatnout (buildnout/pullnout) všechny existující kontejnery, což znamenalo puoze čtvrthodinové zdržení. &lt;strong&gt;Miluju Docker!!!&lt;/strong&gt; Instalovat všechno postaru, to by mě jeblo.&lt;/p&gt;

&lt;h2 id=&quot;spuštění&quot;&gt;Spuštění&lt;/h2&gt;
&lt;p&gt;Easy: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose up -d&lt;/code&gt;. Pak se připojit na &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://ip_serveru:4533&lt;/code&gt;, vytvořit si uživatele a je to. Já jsem si ještě vyrobil site na reverzní proxy s HTTPS pomocí &lt;a href=&quot;/2021/11/05/reverzni-proxy-s-ntlm.html&quot;&gt;proxy-manageru&lt;/a&gt;, abych mohl na svůj &lt;strong&gt;Navidrome&lt;/strong&gt; zvenku.&lt;/p&gt;

&lt;p&gt;Vypadá to takhle:
&lt;img src=&quot;/assets/images/navidrome.png&quot; alt=&quot;Screenshot z Navidrome&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;přístup-z-ios&quot;&gt;Přístup z iOS&lt;/h2&gt;
&lt;p&gt;Zatím jsem nainstaloval &lt;a href=&quot;https://apps.apple.com/us/app/substreamer/id1012991665&quot;&gt;substreamer&lt;/a&gt; a zdá se, že dělá přesně to, co chci. Stačí po instalci jen zadat url svého serveru, username a password a je to. Umí to i offline obsah a dokonce i bookmarky, takže je možné si explicitně uložit, kde jsem přestal. Super!&lt;/p&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Asi by nebylo fér nezmínit, kde jsem na &lt;strong&gt;Navidrome&lt;/strong&gt; přišel. Na skvělém Youtube kanálu &lt;a href=&quot;https://www.youtube.com/channel/UCwFpzG5MK5Shg_ncAhrgr9g&quot;&gt;Awsome Open Source&lt;/a&gt;, který provozuje &lt;strong&gt;Brian McGonagill&lt;/strong&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; je i s chlupama sebraný z jeho &lt;a href=&quot;https://shownotes.opensourceisawesome.com/navidrome-music-streaming/&quot;&gt;shownotes&lt;/a&gt;, já jsem přidal jen, aby se po rebootu serveru zase pustil. Díky!&lt;/p&gt;</content><author><name>bobac</name></author><category term="linux" /><category term="docker" /><category term="mp3" /><category term="audioknihy" /><summary type="html">V minulém blogu jsem psal o mid3v2 k editování MP3 Tagů z CLI. Potřeboval jsem si rozběhnout vlastní streamování MP3, které bude mimo iTunes. Jde o to, že mám pár audioknih, které jsem koupil u Mariana Kechlibara, a které jsem potřeboval oddělit od iTunes. Důvod je poměrně jednoduchý - chci, abych měl rozposlouchanou knihu někde jinde než muziku, z toho prostého důvodu, že iTunes nemá žádné záložky, takže jakmile pustím nějakou hudbu, prd vím, kde jsem přestal poslouchat knížku :-)</summary></entry><entry><title type="html">Tagy na MP3 z CLI</title><link href="/2021/11/17/Tagy-na-mp3-z-cli.html" rel="alternate" type="text/html" title="Tagy na MP3 z CLI" /><published>2021-11-17T00:00:00+01:00</published><updated>2021-11-17T00:00:00+01:00</updated><id>/2021/11/17/Tagy-na-mp3-z-cli</id><content type="html" xml:base="/2021/11/17/Tagy-na-mp3-z-cli.html">&lt;p&gt;Před chvílí jsem zjitil, že potřebuji z command lajny na linuxovém serveru upravovat tagy pro MP3 soubory. Po chvíli googlení jsem přistál u &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mid3v2&lt;/code&gt;. Hlavní důvod je, že by měl podporovat &lt;strong&gt;utf-8&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;instalace&quot;&gt;Instalace&lt;/h2&gt;
&lt;p&gt;Potřebuje &lt;strong&gt;PIP&lt;/strong&gt;. Takže pokud &lt;strong&gt;PIP&lt;/strong&gt; ještě nemáte, nainstalujte jej:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install pip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Po instalaci &lt;strong&gt;PIP&lt;/strong&gt;u nainstalujte &lt;strong&gt;MUTAGEN&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo pip install mutagen
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;použití&quot;&gt;Použití&lt;/h2&gt;
&lt;p&gt;Ověřte, že &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mid3v2&lt;/code&gt; funguje:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mid3v2
Usage: mid3v2 [OPTION] [FILE]...

Mutagen-based replacement for id3lib&apos;s id3v2.

Options:
  --version             show program&apos;s version number and exit
  -h, --help            show this help message and exit
  -v, --verbose         be verbose
  -q, --quiet           be quiet (the default)
  -e, --escape          enable interpretation of backslash escapes
  -f, --list-frames     Display all possible frames for ID3v2.3 / ID3v2.4
  --list-frames-v2.2    Display all possible frames for ID3v2.2
  -L, --list-genres     Lists all ID3v1 genres
  -l, --list            Lists the tag(s) on the open(s)
  --list-raw            Lists the tag(s) on the open(s) in Python format
  -d, --delete-v2       Deletes ID3v2 tags
  -s, --delete-v1       Deletes ID3v1 tags
  -D, --delete-all      Deletes ID3v1 and ID3v2 tags
  --delete-frames=FID1,FID2,...
                        Delete the given frames
  -C, --convert         Convert tags to ID3v2.4 (any editing will do this)
  -a &quot;ARTIST&quot;, --artist=&quot;ARTIST&quot;
                        Set the artist information
  -A &quot;ALBUM&quot;, --album=&quot;ALBUM&quot;
                        Set the album title information
  -t &quot;SONG&quot;, --song=&quot;SONG&quot;
                        Set the song title information
  -c &quot;DESCRIPTION&quot;:&quot;COMMENT&quot;:&quot;LANGUAGE&quot;, --comment=&quot;DESCRIPTION&quot;:&quot;COMMENT&quot;:&quot;LANGUAGE&quot;
                        Set the comment information
  -p &quot;FILENAME&quot;:&quot;DESCRIPTION&quot;:&quot;IMAGE-TYPE&quot;:&quot;MIME-TYPE&quot;, --picture=&quot;FILENAME&quot;:&quot;DESCRIPTION&quot;:&quot;IMAGE-TYPE&quot;:&quot;MIME-TYPE&quot;
                        Set the picture
  -g &quot;GENRE&quot;, --genre=&quot;GENRE&quot;
                        Set the genre or genre number
  -y YYYY[-MM-DD], --year=YYYY[-MM-DD], --date=YYYY[-MM-DD]
                        Set the year/date
  -T &quot;num/num&quot;, --track=&quot;num/num&quot;
                        Set the track number/(optional) total tracks
You can set the value for any ID3v2 frame by using &apos;--&apos; and then a frame ID.
For example:
        mid3v2 --TIT3 &quot;Monkey!&quot; file.mp3
would set the &quot;Subtitle/Description&quot; frame to &quot;Monkey!&quot;.

Any editing operation will cause the ID3 tag to be upgraded to ID3v2.4.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;příklady&quot;&gt;Příklady&lt;/h2&gt;
&lt;p&gt;Přečtení tagů ze souboru:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mid3v2 -l soubor.mp3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Změna čísla stopy určitého souboru (v mém případě tam byl nesmysl):&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mid3v2 --TRCK=5 05_soubor.mp3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nastavení konzistentního jména alba pro všechny mp3 v adresáři (aby iTunes nebo třeba &lt;a href=&quot;https://www.navidrome.org/&quot;&gt;Navidrome&lt;/a&gt;) pro jedno album v adresáři nevyrobil tři samostatná alba, jenom kvůli překlepům/nekonzistencím v tagu:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mid3v2 --TALB=&quot;Jméno alba&quot; *.mp3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Třeba to někomu pomůže, já si to sem píšu hlavně proto, že za dav roky, až to budu zase potřebovat, tak nebudu vědět, co jsem použil a kde to leží :-)&lt;/p&gt;</content><author><name>bobac</name></author><category term="linux" /><category term="mp3" /><summary type="html">Před chvílí jsem zjitil, že potřebuji z command lajny na linuxovém serveru upravovat tagy pro MP3 soubory. Po chvíli googlení jsem přistál u mid3v2. Hlavní důvod je, že by měl podporovat utf-8.</summary></entry><entry><title type="html">Reverzní proxy s NTLM</title><link href="/2021/11/05/reverzni-proxy-s-ntlm.html" rel="alternate" type="text/html" title="Reverzní proxy s NTLM" /><published>2021-11-05T00:00:00+01:00</published><updated>2021-11-05T00:00:00+01:00</updated><id>/2021/11/05/reverzni-proxy-s-ntlm</id><content type="html" xml:base="/2021/11/05/reverzni-proxy-s-ntlm.html">&lt;p&gt;Už před časem jsem narazil na to, že pokud potřebuju někde udělat reverzní proxy, která potřebuje podporu NTLM authentication, tak mám se svým NGINXem smůlu. NGINX totiž podporuje NTLM pouze v placené verzi. Nějakou dobu registruji existenci web serveru &lt;strong&gt;&lt;a href=&quot;https://caddyserver.com/&quot;&gt;Caddy&lt;/a&gt;&lt;/strong&gt;, ale zatím jsem si vždy vystačil s kombem &lt;a href=&quot;https://www.nginx.com/&quot;&gt;NGINX&lt;/a&gt; a geniálním, krásným, a vůbec po všech stránkách velmi povedeným &lt;a href=&quot;https://nginxproxymanager.com/&quot;&gt;Nginx Proxy Managerem&lt;/a&gt;. Důvod, proč jsem vždycky používal &lt;strong&gt;NGINX&lt;/strong&gt; (třeba namísto Apache) byl v tom, že mi styl konfigurace tak nějak šel lépe do ruky. Nějakou dobu jsem řešil &lt;strong&gt;Let’s Encrypt&lt;/strong&gt; certifikáty pomocí jejich skriptů a fungovalo to docela hezky, ale &lt;strong&gt;Nginx Proxy Manager&lt;/strong&gt; to ještě dost zjednodušil - prostě si zaškrtnete, že k danému webu chcete https, necháte jej &lt;em&gt;HTTP&lt;/em&gt; traffic automaticky forwardovat na &lt;em&gt;HTTPS&lt;/em&gt; a o víc se nemusíte starat. Běží to ve dvou kontejnerech, má to hezké klikací webové rozhraní a generujete konfiguráky pro &lt;strong&gt;NGINX&lt;/strong&gt; samo. A taky to samo obnovuje certifikáty. Nádhera! Vypadá to asi takhle:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/proxy-manager.png&quot; alt=&quot;Screenshot z Nginx Proxy Manageru&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Rozběhnout je to hračka - potřebujete soubor &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;, který může vypadat třeba takhle:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: &apos;3&apos;
services:
  app:
    image: &apos;jc21/nginx-proxy-manager:latest&apos;
    restart: unless-stopped
    ports:
      - &apos;80:80&apos;
      - &apos;81:81&apos;
      - &apos;443:443&apos;
    environment:
      DB_MYSQL_HOST: &quot;db&quot;
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: &quot;npm&quot;
      DB_MYSQL_PASSWORD: &quot;npm&quot;
      DB_MYSQL_NAME: &quot;npm&quot;
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
  db:
    image: &apos;jc21/mariadb-aria:latest&apos;
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: &apos;npm&apos;
      MYSQL_DATABASE: &apos;npm&apos;
      MYSQL_USER: &apos;npm&apos;
      MYSQL_PASSWORD: &apos;npm&apos;
    volumes:
      - ./data/mysql:/var/lib/mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Dá se to bez přemýšlení obšlehnout z webu projektu).
Kontejnery pustíte pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose up -d&lt;/code&gt; a pak stačí jen klikat na &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://lokalni_ip:81&lt;/code&gt;. Prvotní uživatelské jméno je &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin@example.com&lt;/code&gt; a heslo je &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;changeme&lt;/code&gt;. Myslel sem si, že už to jednodušší být nemůže…&lt;/p&gt;

&lt;h2 id=&quot;seznamte-se-tohle-je-caddy&quot;&gt;Seznamte se, tohle je Caddy&lt;/h2&gt;
&lt;p&gt;Idea webového serveru &lt;strong&gt;Caddy&lt;/strong&gt; je následující: Všechno musí fungovat v defaultním nastavení tak nějak samo. &lt;strong&gt;Caddy&lt;/strong&gt; je &lt;em&gt;HTTPS&lt;/em&gt; first, tedy pokud &lt;em&gt;HTTPS&lt;/em&gt; explicitně nezakážete, pojede pod &lt;em&gt;HTTPS&lt;/em&gt; a sám si bude točit certifikáty. Konfigurák, který se jmenuje &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Caddyfile&lt;/code&gt;, pro reverzní proxy je až směšně jednoduchej:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;venkovni.server.cz {
  reverse_proxy https://192.168.1.1:443 {
    transport http_ntlm {
      tls_insecure_skip_verify
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Tohle samo vyrobí https://venkovni.server.cz, zařídí si to certifikáty a bude servírovat server na vnitřní https://192.168.1.1:443, který vyžaduje NTLM autentifikaci. V mém případě je vnitřní traffic podepsaný self-signed certifikátem, takže je třeba odstavec &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{ tls_insecure_skip_verify }&lt;/code&gt;, kdybych měl vevnitř jen &lt;em&gt;http&lt;/em&gt;, není třeba ani to.&lt;/p&gt;

&lt;h3 id=&quot;instalace&quot;&gt;Instalace&lt;/h3&gt;
&lt;p&gt;Jediná drobná zrada je v tom, že si nemůžu jen tak vzít hotový &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; nebo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;, protože podpora pro NTLM transport není ve standardní binárce zakompilovaná. Ale i tak je to easy - dalo mi to asi hodinku než jsem na to přišel, a to jenom proto, že před tou hodinkou byly moje znalosti o &lt;strong&gt;Caddym&lt;/strong&gt; následující:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Je to web server/reverzní proxy&lt;/li&gt;
  &lt;li&gt;Je to napsaný v Go&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;To druhý není pro náš případ vůbec podstatný, ale protože se v &lt;em&gt;Go&lt;/em&gt; komunitě už nějakou dobu pohybuju, díky tomu jsem se o &lt;strong&gt;Caddy&lt;/strong&gt; vůbec dozvěděl :-)&lt;/p&gt;

&lt;p&gt;Takže potřebujema dva soubory. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;FROM caddy:2.4.5-builder AS builder

RUN xcaddy build \
    --with github.com/caddyserver/ntlm-transport

FROM caddy:2.4.5

COPY --from=builder /usr/bin/caddy /usr/bin/caddy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: &quot;3.7&quot;

services:
  caddy:
    build: .
    restart: unless-stopped
    ports:
      - &quot;8080:80&quot;
      - &quot;8443:443&quot;
    volumes:
      - $PWD/Caddyfile:/etc/caddy/Caddyfile
      - $PWD/site:/srv
      - $PWD/data:/data
      - $PWD/config:/config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Takže teď už stačí &lt;strong&gt;Caddy&lt;/strong&gt; zbuildit pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose build&lt;/code&gt;. Než ho pustíte, dejte si k těm dvěma souborům do adresáře ještě připravený &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Caddyfile&lt;/code&gt; (viz výše).&lt;/p&gt;

&lt;p&gt;Spustíte pomocí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose up -d&lt;/code&gt;.
A je to.&lt;/p&gt;

&lt;h2 id=&quot;závěr&quot;&gt;Závěr&lt;/h2&gt;
&lt;p&gt;Nevím, jestli se zbavím svého &lt;strong&gt;NGINX&lt;/strong&gt;. Ale jenom kvůli tomu, že na něj existuje to krásný klikátko. &lt;strong&gt;Caddy&lt;/strong&gt; je totiž tak easy, že snad klikátko ani nepotřebuje. Ale pokud budu zase někdy potřebovat reverzní proxy s NTLM (v mém případě to bylo kvůli Windows Admin Center), určitě po Caddym sáhnu. A dost možná, že na něj přejdu úplně a klikátko oželím. Je to zatím nejjednodušší web server, jaký jsem kdy viděl.&lt;/p&gt;</content><author><name>bobac</name></author><category term="proxy" /><category term="linux" /><category term="ntlm" /><summary type="html">Už před časem jsem narazil na to, že pokud potřebuju někde udělat reverzní proxy, která potřebuje podporu NTLM authentication, tak mám se svým NGINXem smůlu. NGINX totiž podporuje NTLM pouze v placené verzi. Nějakou dobu registruji existenci web serveru Caddy, ale zatím jsem si vždy vystačil s kombem NGINX a geniálním, krásným, a vůbec po všech stránkách velmi povedeným Nginx Proxy Managerem. Důvod, proč jsem vždycky používal NGINX (třeba namísto Apache) byl v tom, že mi styl konfigurace tak nějak šel lépe do ruky. Nějakou dobu jsem řešil Let’s Encrypt certifikáty pomocí jejich skriptů a fungovalo to docela hezky, ale Nginx Proxy Manager to ještě dost zjednodušil - prostě si zaškrtnete, že k danému webu chcete https, necháte jej HTTP traffic automaticky forwardovat na HTTPS a o víc se nemusíte starat. Běží to ve dvou kontejnerech, má to hezké klikací webové rozhraní a generujete konfiguráky pro NGINX samo. A taky to samo obnovuje certifikáty. Nádhera! Vypadá to asi takhle:</summary></entry></feed>