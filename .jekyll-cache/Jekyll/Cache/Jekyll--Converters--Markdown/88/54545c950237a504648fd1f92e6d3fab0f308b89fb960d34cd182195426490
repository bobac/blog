I"ï<p>PotÅ™eboval jsem <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>, kterÃ½ buildil image z <code class="language-plaintext highlighter-rouge">Dockerfile</code> mÃ­sto toho, aby ji hotovou odnÄ›kud stahoval, nebo abych ji nemusel buildovat pÅ™edtÃ­m jÃ¡ ruÄnÄ› pomocÃ­ <code class="language-plaintext highlighter-rouge">docker build...</code>. To je docela Å¡ikovnÃ¡ vÄ›c, zejmÃ©na, pokud ta image je to, co zrovna vyvÃ­jÃ­te. <strong>Docker Compose</strong> na to mÃ¡ hezkou direktivu <code class="language-plaintext highlighter-rouge">build</code> mÃ­sto tradiÄnÃ­ <code class="language-plaintext highlighter-rouge">image</code>.</p>

<p>ProblÃ©m je v tom, Å¾e jsem potÅ™eboval 2 rÅ¯znÃ© service, kterÃ© ale budou vÅ¾dy zbuildÄ›nÃ© (krÃ¡snÃ½ ÄeskÃ½ slovo) ze stejnÃ© image. NejdÅ™Ã­v jsem to nahulvÃ¡ta dÄ›lal tak, Å¾e jsem prostÄ› v kaÅ¾dÃ© service znova buildil, ale pak mÄ› okolnosti donutily chvÃ­li buildit s direktivou <code class="language-plaintext highlighter-rouge">--no-cache</code> a celÃ© se to zaÄelo nÄ›jak vlÃ©ct. NezbÃ½valo neÅ¾ zaÄÃ­t gÅ¯glit, jak to udÄ›lat, aby build probÄ›hl jen jednou a druhÃ¡ service jej jen pouÅ¾ila.</p>

<h2 id="jak-na-to">Jak na to</h2>
<p>Je to samozÅ™ejmÄ› easy. StaÄÃ­, aby prvnÃ­ service udÄ›lala build a zÃ¡roveÅˆ hotovou image nÄ›jak pojmenovala, a pak uÅ¾ jen staÄÃ­, aby ta druhÃ¡ pouÅ¾ila tuhle image a mÄ›la nastavenou dependecy na tÃ© prvnÃ­. Asi takhle <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'

services:

  master:
      build: .
      image: mojeimage

  slave:
      image: mojeimage
      depends_on: master
</code></pre></div></div>

<h2 id="pouÅ¾itÃ­">PouÅ¾itÃ­</h2>
<p>Pak uÅ¾ staÄÃ­ jen image zbuildit pomocÃ­ <code class="language-plaintext highlighter-rouge">docker-compose build</code>. Docker Compose buildne <code class="language-plaintext highlighter-rouge">master</code> image a pojmenuje ji <code class="language-plaintext highlighter-rouge">mojeimage</code>.NÃ¡slednÃ½ <code class="language-plaintext highlighter-rouge">docker-compose up</code> uÅ¾ pustÃ­ obÄ› services z jedinÃ© image.</p>

<h3 id="poznÃ¡mka">PoznÃ¡mka</h3>
<p>Preferuji vytvoÅ™enÃ­ <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> a nÃ¡slednÃ© buildÄ›nÃ­ (pokud to jde) pomocÃ­ <strong>Docker Compose</strong> zejmÃ©na proto, Å¾e v podstatÄ› pÅ™edpis (kterÃ½ tak jako tak potÅ™ebuju) mÃ¡m v <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> a nemusÃ­m pÅ™emÃ½Å¡let (to bolÃ­ vÅ¾dy) nad tÃ­m, jak pojmenovat image apod. tak, aby to fungovalo. SamozÅ™ejmÄ›, Å¾e by fungovalo ruÄnÄ› zbuildit pomocÃ­ <code class="language-plaintext highlighter-rouge">docker build -t mojeimage .</code>, ale tam bych musel jmÃ©no image nejdÅ™Ã­v stejnÄ› vyÄÃ­st ze svÃ©ho <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>. Takhle je to jednoduÅ¡Å¡Ã­ :-)</p>

<h2 id="credits">Credits</h2>
<p>CelÃ© jsem to ukradl na <a href="https://stackoverflow.com/questions/50019948/reuse-image-built-by-one-service-in-another-service/50025029#:~:text=28-,Docker%20Compose,-builds%20your%20image">Stack Overflow</a>.</p>
:ET